<v-container class="portfolio-page">
  <!-- ページヘッダー -->
  <v-row class="mb-6">
    <v-col cols="12">
      <v-card class="pa-4" color="primary" dark>
        <v-card-title class="text-h4 font-weight-bold">
          <v-icon left size="32">mdi-briefcase-outline</v-icon>
          実績ポートフォリオ
        </v-card-title>
        <v-card-subtitle class="text-h6">
          Phirosoftの開発実績・プロジェクト一覧
        </v-card-subtitle>
      </v-card>
    </v-col>
  </v-row>

  <!-- フィルター・検索セクション -->
  <v-row class="mb-4">
    <v-col cols="12" md="6">
      <v-text-field
        v-model="searchQuery"
        label="プロジェクト検索"
        prepend-inner-icon="mdi-magnify"
        outlined
        clearable
        hint="プロジェクト名、技術スタック、クライアントで検索"
        @input="updateFilteredProjects"
      ></v-text-field>
    </v-col>
    <v-col cols="12" md="3">
      <v-select
        v-model="selectedCategory"
        :items="categories"
        label="カテゴリ"
        outlined
        clearable
        @change="updateFilteredProjects"
      ></v-select>
    </v-col>
    <v-col cols="12" md="3">
      <v-select
        v-model="selectedYear"
        :items="years"
        label="年度"
        outlined
        clearable
        @change="updateFilteredProjects"
      ></v-select>
    </v-col>
  </v-row>

  <!-- 実績統計サマリー -->
  <v-row class="mb-6">
    <v-col cols="6" md="3">
      <v-card class="text-center pa-4" color="success" dark>
        <v-icon size="40" class="mb-2">mdi-check-circle</v-icon>
        <div class="text-h4 font-weight-bold">{{ totalProjects }}</div>
        <div class="text-subtitle-1">総プロジェクト数</div>
      </v-card>
    </v-col>
    <v-col cols="6" md="3">
      <v-card class="text-center pa-4" color="info" dark>
        <v-icon size="40" class="mb-2">mdi-account-group</v-icon>
        <div class="text-h4 font-weight-bold">{{ totalClients }}</div>
        <div class="text-subtitle-1">クライアント数</div>
      </v-card>
    </v-col>
    <v-col cols="6" md="3">
      <v-card class="text-center pa-4" color="warning" dark>
        <v-icon size="40" class="mb-2">mdi-code-tags</v-icon>
        <div class="text-h4 font-weight-bold">{{ totalTechnologies }}</div>
        <div class="text-subtitle-1">使用技術数</div>
      </v-card>
    </v-col>
    <v-col cols="6" md="3">
      <v-card class="text-center pa-4" color="error" dark>
        <v-icon size="40" class="mb-2">mdi-calendar</v-icon>
        <div class="text-h4 font-weight-bold">{{ currentYear - startYear }}+</div>
        <div class="text-subtitle-1">開発経験年数</div>
      </v-card>
    </v-col>
  </v-row>

  <!-- 実績プロジェクト一覧 -->
  <v-row>
    <v-col
      v-for="project in filteredProjects"
      :key="project.id"
      cols="12"
      md="6"
      lg="4"
    >
      <v-card class="ma-2 portfolio-card" elevation="3" @click="openProjectDetail(project)">
        <!-- プロジェクト画像 -->
        <v-img
          :src="project.image"
          :alt="project.title + 'のスクリーンショット'"
          height="200"
          class="white--text align-end"
          gradient="to bottom, rgba(0,0,0,.1), rgba(0,0,0,.7)"
        >
          <v-card-title class="text-h6 font-weight-bold">
            {{ project.title }}
          </v-card-title>
        </v-img>

        <!-- プロジェクト基本情報 -->
        <v-card-subtitle class="pb-2">
          <v-chip
            :color="getCategoryColor(project.category)"
            small
            dark
            class="mr-2"
          >
            {{ project.category }}
          </v-chip>
          <span class="text-caption">{{ project.period }}</span>
        </v-card-subtitle>

        <v-card-text>
          <div class="text-body-2 mb-3">
            {{ project.description }}
          </div>

          <!-- 技術スタック -->
          <div class="mb-3">
            <div class="text-caption font-weight-bold mb-1">技術スタック:</div>
            <v-chip
              v-for="tech in project.technologies.slice(0, 3)"
              :key="tech"
              x-small
              outlined
              class="mr-1 mb-1"
            >
              {{ tech }}
            </v-chip>
            <v-chip
              v-if="project.technologies.length > 3"
              x-small
              outlined
              color="grey"
              class="mr-1 mb-1"
            >
              +{{ project.technologies.length - 3 }}
            </v-chip>
          </div>

          <!-- プロジェクト規模・役割 -->
          <div class="d-flex justify-space-between align-center">
            <div>
              <v-icon small>mdi-account-group</v-icon>
              <span class="text-caption ml-1">{{ project.teamSize }}人</span>
            </div>
            <div>
              <v-icon small>mdi-account</v-icon>
              <span class="text-caption ml-1">{{ project.role }}</span>
            </div>
          </div>
        </v-card-text>

        <v-card-actions>
          <v-spacer></v-spacer>
          <v-btn
            v-if="project.demoUrl"
            color="primary"
            text
            small
            :href="project.demoUrl"
            target="_blank"
            @click.stop
          >
            <v-icon left small>mdi-open-in-new</v-icon>
            デモ
          </v-btn>
          <v-btn
            v-if="project.githubUrl"
            color="grey"
            text
            small
            :href="project.githubUrl"
            target="_blank"
            @click.stop
          >
            <v-icon left small>mdi-github</v-icon>
            GitHub
          </v-btn>
          <v-btn color="info" text small>
            <v-icon left small>mdi-information</v-icon>
            詳細
          </v-btn>
        </v-card-actions>
      </v-card>
    </v-col>
  </v-row>

  <!-- プロジェクトが見つからない場合の表示 -->
  <v-row v-if="filteredProjects.length === 0" class="mt-6">
    <v-col cols="12" class="text-center">
      <v-card class="pa-6" color="grey lighten-4">
        <v-icon size="64" color="grey">mdi-folder-open-outline</v-icon>
        <div class="text-h6 mt-3 grey--text">検索条件に一致するプロジェクトが見つかりません</div>
        <div class="text-body-2 grey--text">検索条件を変更してお試しください</div>
      </v-card>
    </v-col>
  </v-row>

  <!-- プロジェクト詳細ダイアログ -->
  <v-dialog v-model="projectDialog" max-width="800px" scrollable>
    <v-card v-if="selectedProject">
      <v-card-title class="text-h5 font-weight-bold primary white--text">
        <v-icon left color="white">mdi-briefcase-outline</v-icon>
        {{ selectedProject.title }}
        <v-spacer></v-spacer>
        <v-btn icon dark @click="projectDialog = false">
          <v-icon>mdi-close</v-icon>
        </v-btn>
      </v-card-title>

      <v-card-text class="pa-6">
        <!-- プロジェクト画像 -->
        <v-img
          v-if="selectedProject.image"
          :src="selectedProject.image"
          :alt="selectedProject.title + 'のスクリーンショット'"
          max-height="300"
          class="mb-4"
        ></v-img>

        <!-- プロジェクト詳細情報 -->
        <v-row class="mb-4">
          <v-col cols="12" md="6">
            <div class="text-subtitle-1 font-weight-bold mb-2">プロジェクト概要</div>
            <div class="text-body-2">{{ selectedProject.description }}</div>
          </v-col>
          <v-col cols="12" md="6">
            <div class="text-subtitle-1 font-weight-bold mb-2">基本情報</div>
            <v-simple-table dense>
              <tbody>
                <tr>
                  <td class="font-weight-medium">カテゴリ</td>
                  <td>
                    <v-chip
                      :color="getCategoryColor(selectedProject.category)"
                      small
                      dark
                    >
                      {{ selectedProject.category }}
                    </v-chip>
                  </td>
                </tr>
                <tr>
                  <td class="font-weight-medium">期間</td>
                  <td>{{ selectedProject.period }}</td>
                </tr>
                <tr>
                  <td class="font-weight-medium">チーム規模</td>
                  <td>{{ selectedProject.teamSize }}人</td>
                </tr>
                <tr>
                  <td class="font-weight-medium">担当役割</td>
                  <td>{{ selectedProject.role }}</td>
                </tr>
                <tr v-if="selectedProject.client">
                  <td class="font-weight-medium">クライアント</td>
                  <td>{{ selectedProject.client }}</td>
                </tr>
              </tbody>
            </v-simple-table>
          </v-col>
        </v-row>

        <!-- 詳細説明 -->
        <div v-if="selectedProject.details" class="mb-4">
          <div class="text-subtitle-1 font-weight-bold mb-2">詳細説明</div>
          <div class="text-body-2" style="white-space: pre-line;">
            {{ selectedProject.details }}
          </div>
        </div>

        <!-- 技術スタック -->
        <div class="mb-4">
          <div class="text-subtitle-1 font-weight-bold mb-2">使用技術</div>
          <v-chip
            v-for="tech in selectedProject.technologies"
            :key="tech"
            small
            outlined
            class="mr-2 mb-2"
          >
            {{ tech }}
          </v-chip>
        </div>

        <!-- 成果・学び -->
        <div v-if="selectedProject.achievements" class="mb-4">
          <div class="text-subtitle-1 font-weight-bold mb-2">成果・学び</div>
          <ul class="ml-4">
            <li
              v-for="achievement in selectedProject.achievements"
              :key="achievement"
              class="text-body-2 mb-1"
            >
              {{ achievement }}
            </li>
          </ul>
        </div>
      </v-card-text>

      <v-card-actions class="pa-4">
        <v-btn
          v-if="selectedProject.demoUrl"
          color="primary"
          :href="selectedProject.demoUrl"
          target="_blank"
        >
          <v-icon left>mdi-open-in-new</v-icon>
          デモを見る
        </v-btn>
        <v-btn
          v-if="selectedProject.githubUrl"
          color="grey darken-1"
          text
          :href="selectedProject.githubUrl"
          target="_blank"
        >
          <v-icon left>mdi-github</v-icon>
          GitHub
        </v-btn>
        <v-spacer></v-spacer>
        <v-btn color="grey darken-1" text @click="projectDialog = false">
          閉じる
        </v-btn>
      </v-card-actions>
    </v-card>
  </v-dialog>
</v-container>
